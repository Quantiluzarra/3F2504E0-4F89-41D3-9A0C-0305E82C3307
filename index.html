<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="dark" />
  <title>–®–ò–§–†–û–¢–ï–ö–° ‚Äî –∑–∞—â–∏—â—ë–Ω–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</title>
  <style>
    :root{
      /* Fallback (–µ—Å–ª–∏ –Ω–µ Telegram) */
      --tg-bg: #0b0f14;
      --tg-secondary-bg: #101823;
      --tg-card: rgba(255,255,255,.06);
      --tg-card-2: rgba(255,255,255,.08);
      --tg-text: #e8eef7;
      --tg-hint: rgba(232,238,247,.62);
      --tg-border: rgba(120, 230, 200, .18);
      --tg-accent: #22d3a6;
      --tg-accent-2: #00a884;
      --tg-danger: #ff6b6b;

      --radius: 18px;
      --radius-sm: 12px;

      --shadow: 0 14px 45px rgba(0,0,0,.45);
      --shadow-soft: 0 8px 28px rgba(0,0,0,.35);

      --pad: 16px;
      --pad-lg: 22px;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --ui: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;

      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --safe-left: env(safe-area-inset-left, 0px);
      --safe-right: env(safe-area-inset-right, 0px);

      --anim: 220ms;
      --anim-slow: 420ms;
      --ease: cubic-bezier(.2,.8,.2,1);
    }

    @media (prefers-reduced-motion: reduce){
      :root{ --anim: 1ms; --anim-slow: 1ms; }
      *{ animation-duration: 1ms !important; transition-duration: 1ms !important; scroll-behavior: auto !important; }
    }

    *{ box-sizing: border-box; }
    html, body{ height: 100%; }
    body{
      margin: 0;
      font-family: var(--ui);
      color: var(--tg-text);
      background:
        radial-gradient(1200px 600px at 15% 10%, rgba(34, 211, 166, .18), transparent 55%),
        radial-gradient(900px 500px at 85% 25%, rgba(0, 168, 132, .14), transparent 60%),
        linear-gradient(180deg, #06080c 0%, var(--tg-bg) 45%, #06080c 100%);
      min-height: 100%;
      padding:
        calc(var(--safe-top) + 14px)
        calc(var(--safe-right) + 14px)
        calc(var(--safe-bottom) + 16px)
        calc(var(--safe-left) + 14px);
      overflow-x: hidden;
    }

    .wrap{
      max-width: 1100px;
      margin: 0 auto;
      display: grid;
      gap: 14px;
    }

    /* Header */
    .topbar{
      position: sticky;
      top: calc(var(--safe-top) + 10px);
      z-index: 20;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      background: linear-gradient(180deg, rgba(8,12,18,.78), rgba(8,12,18,.55));
      border: 1px solid var(--tg-border);
      border-radius: var(--radius);
      box-shadow: var(--shadow-soft);
      padding: 14px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      animation: pop var(--anim-slow) var(--ease);
    }

    .brand{
      display:flex;
      flex-direction:column;
      gap: 2px;
      min-width: 0;
    }
    .brand h1{
      margin: 0;
      font-size: 15px;
      letter-spacing: 1.8px;
      text-transform: uppercase;
      display:flex;
      align-items:center;
      gap: 10px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      font-family: var(--mono);
      font-size: 11px;
      color: var(--tg-hint);
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .dot{
      width: 9px; height: 9px; border-radius: 999px;
      background: var(--tg-accent);
      box-shadow: 0 0 0 6px rgba(34,211,166,.12), 0 0 18px rgba(34,211,166,.35);
      animation: pulse 1.9s var(--ease) infinite;
    }

    /* Tabs */
    .tabs{
      position: relative;
      display:flex;
      gap: 8px;
      flex-wrap: wrap;
      padding: 10px;
      border-radius: var(--radius);
      background: rgba(255,255,255,.03);
      border: 1px solid var(--tg-border);
      box-shadow: var(--shadow-soft);
      overflow: hidden;
      animation: pop var(--anim-slow) var(--ease);
    }
    .tab{
      position: relative;
      border: 0;
      cursor: pointer;
      user-select:none;
      padding: 10px 12px;
      border-radius: 999px;
      background: transparent;
      color: var(--tg-hint);
      font-weight: 700;
      font-size: 12px;
      letter-spacing: .8px;
      text-transform: uppercase;
      transition: transform var(--anim) var(--ease), color var(--anim) var(--ease), background var(--anim) var(--ease);
    }
    .tab:hover{ color: var(--tg-text); transform: translateY(-1px); }
    .tab.active{
      color: #061013;
      background: linear-gradient(135deg, var(--tg-accent) 0%, #2ee9bd 55%, var(--tg-accent-2) 100%);
      box-shadow: 0 10px 26px rgba(34,211,166,.24);
    }
    .tab:focus{ outline: 2px solid rgba(34,211,166,.45); outline-offset: 2px; }

    /* Cards */
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
    }

    .card{
      border-radius: var(--radius);
      border: 1px solid var(--tg-border);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      padding: var(--pad-lg);
      overflow: hidden;
      position: relative;
      transform: translateZ(0);
      animation: pop var(--anim-slow) var(--ease);
    }
    .card::before{
      content:"";
      position:absolute;
      inset: -40% -20% auto -20%;
      height: 240px;
      background: radial-gradient(closest-side, rgba(34,211,166,.18), transparent 70%);
      filter: blur(10px);
      pointer-events:none;
    }
    .title{
      margin: 0 0 14px 0;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .title .h{
      font-family: var(--mono);
      letter-spacing: 1.4px;
      text-transform: uppercase;
      font-size: 12px;
      color: rgba(34,211,166,.95);
      display:flex;
      align-items:center;
      gap: 10px;
    }
    .badge{
      font-family: var(--mono);
      font-size: 10px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(34,211,166,.25);
      background: rgba(34,211,166,.06);
      color: rgba(232,238,247,.78);
      white-space: nowrap;
    }

    /* Inputs */
    .group{ margin-bottom: 14px; }
    label{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      font-size: 11px;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: var(--tg-hint);
      margin: 0 0 8px 0;
    }
    .hint{
      font-family: var(--mono);
      font-size: 10px;
      color: rgba(232,238,247,.55);
      text-transform:none;
      letter-spacing: 0;
    }
    textarea, input[type="password"], input[type="text"], select{
      width: 100%;
      border-radius: var(--radius-sm);
      border: 1px solid rgba(34,211,166,.22);
      background: rgba(5, 7, 10, .7);
      color: var(--tg-text);
      padding: 12px 12px;
      font-size: 13px;
      line-height: 1.45;
      font-family: var(--mono);
      transition: border-color var(--anim) var(--ease), box-shadow var(--anim) var(--ease), transform var(--anim) var(--ease);
      outline: none;
    }
    textarea{ min-height: 132px; resize: vertical; word-break: break-word; }
    textarea:focus, input:focus, select:focus{
      border-color: rgba(34,211,166,.55);
      box-shadow: 0 0 0 4px rgba(34,211,166,.12);
      transform: translateY(-1px);
    }

    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (max-width: 520px){
      .row{ grid-template-columns: 1fr; }
    }

    /* Switch */
    .switch{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: var(--radius-sm);
      border: 1px solid rgba(34,211,166,.18);
      background: rgba(255,255,255,.03);
      transition: transform var(--anim) var(--ease), border-color var(--anim) var(--ease);
      user-select: none;
    }
    .switch:hover{ transform: translateY(-1px); border-color: rgba(34,211,166,.35); }
    .switch input{ width: 18px; height: 18px; accent-color: var(--tg-accent); }
    .switch span{ font-size: 12px; color: rgba(232,238,247,.85); }

    /* Buttons + ripple */
    .btns{ display:flex; gap: 10px; flex-wrap: wrap; }
    .btn{
      position: relative;
      overflow: hidden;
      border: 0;
      cursor: pointer;
      border-radius: 14px;
      padding: 12px 14px;
      font-weight: 900;
      letter-spacing: .9px;
      text-transform: uppercase;
      font-size: 12px;
      color: #071114;
      background: linear-gradient(135deg, var(--tg-accent) 0%, #2ee9bd 55%, var(--tg-accent-2) 100%);
      box-shadow: 0 12px 30px rgba(34,211,166,.22);
      transition: transform var(--anim) var(--ease), filter var(--anim) var(--ease);
      flex: 1;
      min-width: 140px;
    }
    .btn:hover{ transform: translateY(-2px); filter: saturate(1.05); }
    .btn:active{ transform: translateY(0px) scale(.99); }

    .btn.secondary{
      color: rgba(232,238,247,.92);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border: 1px solid rgba(34,211,166,.22);
      box-shadow: 0 10px 25px rgba(0,0,0,.22);
    }
    .btn.danger{
      color: #1a0707;
      background: linear-gradient(135deg, #ff7a7a, #ffb0b0);
      box-shadow: 0 12px 30px rgba(255,107,107,.18);
    }

    .ripple{
      position:absolute;
      border-radius:999px;
      transform: scale(0);
      animation: ripple 520ms var(--ease);
      background: rgba(255,255,255,.38);
      pointer-events:none;
      mix-blend-mode: overlay;
    }
    @keyframes ripple{
      to{ transform: scale(14); opacity: 0; }
    }

    /* Output box with shimmer */
    .out{
      border-radius: var(--radius-sm);
      border: 1px solid rgba(34,211,166,.18);
      background: rgba(0,0,0,.35);
      padding: 12px;
      min-height: 112px;
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(34,211,166,.95);
      word-break: break-all;
      overflow:auto;
      position: relative;
    }
    .out.loading::after{
      content:"";
      position:absolute;
      inset: 0;
      background:
        linear-gradient(90deg,
          transparent 0%,
          rgba(255,255,255,.06) 35%,
          rgba(255,255,255,.12) 50%,
          rgba(255,255,255,.06) 65%,
          transparent 100%);
      transform: translateX(-100%);
      animation: shimmer 900ms linear infinite;
      pointer-events:none;
    }
    @keyframes shimmer{
      to{ transform: translateX(100%); }
    }

    /* Toasts */
    .toast-wrap{
      position: fixed;
      left: 0; right: 0;
      bottom: calc(var(--safe-bottom) + 12px);
      display:flex;
      justify-content:center;
      pointer-events:none;
      z-index: 50;
      padding: 0 14px;
    }
    .toast{
      pointer-events:auto;
      max-width: 920px;
      width: 100%;
      border-radius: 16px;
      border: 1px solid var(--tg-border);
      background: rgba(8,12,18,.82);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      box-shadow: var(--shadow);
      padding: 12px 14px;
      display:flex;
      align-items:flex-start;
      gap: 10px;
      transform: translateY(14px);
      opacity: 0;
      transition: opacity var(--anim) var(--ease), transform var(--anim) var(--ease);
    }
    .toast.show{ opacity: 1; transform: translateY(0px); }
    .toast .t{
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(232,238,247,.9);
      line-height: 1.35;
    }
    .pill{
      width: 10px; height: 10px; border-radius: 999px; margin-top: 4px;
      background: var(--tg-accent);
      box-shadow: 0 0 0 6px rgba(34,211,166,.12);
      flex: 0 0 auto;
    }
    .pill.err{ background: var(--tg-danger); box-shadow: 0 0 0 6px rgba(255,107,107,.12); }
    .pill.warn{ background: #ffd166; box-shadow: 0 0 0 6px rgba(255,209,102,.14); }

    /* Sections */
    .section{ display:none; }
    .section.active{ display:block; animation: fadeUp var(--anim-slow) var(--ease); }

    /* Footer */
    .footer{
      opacity: .7;
      text-align:center;
      font-size: 11px;
      color: var(--tg-hint);
      padding: 10px 4px 2px;
    }

    @keyframes fadeUp{
      from{ opacity: 0; transform: translateY(8px); }
      to{ opacity: 1; transform: translateY(0px); }
    }
    @keyframes pop{
      from{ opacity: 0; transform: translateY(10px) scale(.99); }
      to{ opacity: 1; transform: translateY(0px) scale(1); }
    }
    @keyframes pulse{
      0%, 100%{ opacity: 1; transform: scale(1); }
      50%{ opacity: .55; transform: scale(.96); }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <h1><span class="dot"></span> –®–ò–§–†–û–¢–ï–ö–°</h1>
        <div class="chip">–õ–æ–∫–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ ‚Ä¢ AES‚ÄëGCM ‚Ä¢ Telegram WebApp ready</div>
      </div>
      <div class="chip" id="runtimeInfo">–ì–æ—Ç–æ–≤–æ</div>
    </div>

    <div class="tabs" id="tabs">
      <button class="tab active" data-tab="enc">–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</button>
      <button class="tab" data-tab="dec">–î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</button>
      <button class="tab" data-tab="key">–ö–ª—é—á–∏</button>
      <button class="tab" data-tab="log">–ñ—É—Ä–Ω–∞–ª</button>
    </div>

    <!-- –®–ò–§–†–û–í–ê–ù–ò–ï -->
    <section class="section active" id="sec-enc">
      <div class="grid">
        <div class="card">
          <div class="title">
            <div class="h">üìù –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</div>
            <div class="badge">–†–µ–∂–∏–º: AES‚ÄëGCM</div>
          </div>

          <div class="group">
            <label for="pt">–¢–µ–∫—Å—Ç <span class="hint">–ë–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä</span></label>
            <textarea id="pt" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç..."></textarea>
          </div>

          <div class="row">
            <div class="group">
              <label for="encAlgo">–ê–ª–≥–æ—Ä–∏—Ç–º</label>
              <select id="encAlgo">
                <option value="aes256">AES‚Äë256‚ÄëGCM</option>
                <option value="aes192">AES‚Äë192‚ÄëGCM</option>
                <option value="aes128">AES‚Äë128‚ÄëGCM</option>
              </select>
            </div>
            <div class="group">
              <label for="encPass">–ü–∞—Ä–æ–ª—å/–∫–ª—é—á <span class="hint">–º–∏–Ω. 8 —Å–∏–º–≤–æ–ª–æ–≤</span></label>
              <input id="encPass" type="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å..." />
            </div>
          </div>

          <div class="group">
            <div class="switch">
              <input id="showEnc" type="checkbox" />
              <span>–ü–æ–∫–∞–∑–∞—Ç—å –ø–∞—Ä–æ–ª—å</span>
            </div>
          </div>

          <div class="btns">
            <button class="btn" id="btnGenPass">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn secondary" id="btnCopyPass">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
          </div>
        </div>

        <div class="card">
          <div class="title">
            <div class="h">üîê –†–µ–∑—É–ª—å—Ç–∞—Ç</div>
            <div class="badge" id="encMeta">0 —Å–∏–º–≤–æ–ª–æ–≤</div>
          </div>

          <div class="group">
            <label>–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ <span class="hint">Base64 (IV + ciphertext)</span></label>
            <div class="out" id="ctOut"></div>
          </div>

          <div class="btns">
            <button class="btn" id="btnEncrypt">–®–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn secondary" id="btnCopyCT">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn secondary" id="btnSaveCT">–°–∫–∞—á–∞—Ç—å</button>
          </div>
        </div>
      </div>
    </section>

    <!-- –î–ï–®–ò–§–†–û–í–ê–ù–ò–ï -->
    <section class="section" id="sec-dec">
      <div class="grid">
        <div class="card">
          <div class="title">
            <div class="h">üì• –í–≤–æ–¥</div>
            <div class="badge">–ê–≤—Ç–æ‚Äë–ø–æ–¥–±–æ—Ä AES‚Äë–∫–ª—é—á–∞</div>
          </div>

          <div class="group">
            <label for="ct">–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç <span class="hint">–í—Å—Ç–∞–≤—å—Ç–µ Base64</span></label>
            <textarea id="ct" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ..."></textarea>
          </div>

          <div class="group">
            <label for="decPass">–ü–∞—Ä–æ–ª—å</label>
            <input id="decPass" type="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å..." />
          </div>

          <div class="group">
            <div class="switch">
              <input id="showDec" type="checkbox" />
              <span>–ü–æ–∫–∞–∑–∞—Ç—å –ø–∞—Ä–æ–ª—å</span>
            </div>
          </div>

          <div class="btns">
            <button class="btn" id="btnDecrypt">–î–µ—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
          </div>
        </div>

        <div class="card">
          <div class="title">
            <div class="h">üì§ –í—ã–≤–æ–¥</div>
            <div class="badge" id="decMeta">0 —Å–∏–º–≤–æ–ª–æ–≤</div>
          </div>

          <div class="group">
            <label>–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
            <div class="out" id="ptOut"></div>
          </div>

          <div class="btns">
            <button class="btn secondary" id="btnCopyPT">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn secondary" id="btnSavePT">–°–∫–∞—á–∞—Ç—å</button>
          </div>
        </div>
      </div>
    </section>

    <!-- –ö–õ–Æ–ß–ò -->
    <section class="section" id="sec-key">
      <div class="grid">
        <div class="card">
          <div class="title">
            <div class="h">üîë –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π</div>
            <div class="badge">crypto.getRandomValues</div>
          </div>

          <div class="row">
            <div class="group">
              <label for="keyType">–¢–∏–ø</label>
              <select id="keyType">
                <option value="password">–ü–∞—Ä–æ–ª—å</option>
                <option value="hex256">HEX 256 –±–∏—Ç</option>
                <option value="b64256">Base64 256 –±–∏—Ç</option>
              </select>
            </div>
            <div class="group" id="lenGroup">
              <label for="keyLen">–î–ª–∏–Ω–∞</label>
              <select id="keyLen">
                <option value="16">16</option>
                <option value="24">24</option>
                <option value="32" selected>32</option>
                <option value="64">64</option>
              </select>
            </div>
          </div>

          <div class="btns">
            <button class="btn" id="btnGenKey">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn secondary" id="btnUseKey">–í —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</button>
          </div>
        </div>

        <div class="card">
          <div class="title">
            <div class="h">üßæ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ</div>
            <div class="badge" id="keyMeta">‚Äî</div>
          </div>

          <div class="group">
            <label>–ö–ª—é—á/–ø–∞—Ä–æ–ª—å</label>
            <div class="out" id="keyOut"></div>
          </div>

          <div class="btns">
            <button class="btn secondary" id="btnCopyKey">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn secondary" id="btnSaveKey">–°–∫–∞—á–∞—Ç—å</button>
          </div>
        </div>
      </div>
    </section>

    <!-- –ñ–£–†–ù–ê–õ -->
    <section class="section" id="sec-log">
      <div class="card">
        <div class="title">
          <div class="h">üìã –ñ—É—Ä–Ω–∞–ª –æ–ø–µ—Ä–∞—Ü–∏–π</div>
          <div class="badge" id="logMeta">0 –∑–∞–ø–∏—Å–µ–π</div>
        </div>

        <div class="group">
          <label>–°–æ–±—ã—Ç–∏—è</label>
          <div class="out" id="logOut" style="color: rgba(232,238,247,.78); min-height: 220px;"></div>
        </div>

        <div class="btns">
          <button class="btn secondary" id="btnExportLog">–≠–∫—Å–ø–æ—Ä—Ç</button>
          <button class="btn danger" id="btnClearLog">–û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
      </div>
    </section>

    <div class="footer">
      ‚ö† –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –¥–ª—è ¬´–≥–æ—Å‚Äë—É—Ä–æ–≤–Ω—è¬ª —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –Ω—É–∂–Ω—ã —Å–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ì–û–°–¢‚Äë–∞–ª–≥–æ—Ä–∏—Ç–º—ã –∏ —Å—Ä–µ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è; –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π WebCrypto –¥–∞—ë—Ç —Å–∏–ª—å–Ω—É—é –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫—É—é –∑–∞—â–∏—Ç—É, –Ω–æ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å—Ä–µ–¥—Å—Ç–≤–æ–º.
    </div>
  </div>

  <div class="toast-wrap">
    <div class="toast" id="toast">
      <div class="pill" id="toastPill"></div>
      <div class="t" id="toastText"></div>
    </div>
  </div>

<script>
(() => {
  // ========= Telegram WebApp integration =========
  const tg = window.Telegram?.WebApp;
  if (tg) {
    try {
      tg.ready();
      tg.expand(); // —Ä–∞—Å—à–∏—Ä–∏—Ç—å –æ–∫–Ω–æ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è [web:5]
      // –¶–≤–µ—Ç–∞ (–ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Telegram Mini Apps theming) [web:13]
      const tp = tg.themeParams || {};
      if (tp.bg_color) document.documentElement.style.setProperty('--tg-bg', tp.bg_color);
      if (tp.secondary_bg_color) document.documentElement.style.setProperty('--tg-secondary-bg', tp.secondary_bg_color);
      if (tp.text_color) document.documentElement.style.setProperty('--tg-text', tp.text_color);
      if (tp.hint_color) document.documentElement.style.setProperty('--tg-hint', tp.hint_color);
      if (tp.button_color) document.documentElement.style.setProperty('--tg-accent', tp.button_color);
      // –ú–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ–¥–∫—Ä–∞—Å–∏—Ç—å –Ω–∞—Ç–∏–≤–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏:
      if (tg.setHeaderColor) tg.setHeaderColor(tp.secondary_bg_color || '#0b0f14');
      if (tg.setBackgroundColor) tg.setBackgroundColor(tp.bg_color || '#0b0f14');
    } catch (e) {}
  }

  // ========= Helpers =========
  const $ = (id) => document.getElementById(id);
  const runtimeInfo = $('runtimeInfo');

  const log = [];
  const logOut = $('logOut');
  const logMeta = $('logMeta');

  function ts() {
    return new Date().toLocaleString('ru-RU');
  }

  function haptic(type='impact', style='light'){
    const h = tg?.HapticFeedback;
    try {
      if (!h) return;
      if (type === 'impact' && h.impactOccurred) h.impactOccurred(style);
      if (type === 'notify' && h.notificationOccurred) h.notificationOccurred(style); // 'success'|'warning'|'error'
    } catch (e) {}
  }

  function addLog(op, status, details=''){
    log.push({ t: ts(), op, status, details });
    if (log.length > 400) log.shift();
    renderLog();
  }

  function renderLog(){
    logMeta.textContent = `${log.length} –∑–∞–ø–∏—Å–µ–π`;
    if (!log.length) {
      logOut.textContent = '–ñ—É—Ä–Ω–∞–ª –ø—É—Å—Ç.';
      return;
    }
    logOut.textContent = log.slice().reverse().map(x =>
      `[${x.t}] ${x.op} [${x.status}]${x.details ? ' ‚Äî ' + x.details : ''}`
    ).join('\n');
  }

  let toastTimer = null;
  function toast(kind, text){
    const t = $('toast'), pill = $('toastPill'), tt = $('toastText');
    tt.textContent = text;
    pill.className = 'pill' + (kind==='error' ? ' err' : kind==='warn' ? ' warn' : '');
    t.classList.add('show');

    if (toastTimer) clearTimeout(toastTimer);
    toastTimer = setTimeout(() => t.classList.remove('show'), 2400);

    if (kind==='ok') haptic('notify','success');
    if (kind==='warn') haptic('notify','warning');
    if (kind==='error') haptic('notify','error');
  }

  function bytesToHex(u8){
    return Array.from(u8).map(b => b.toString(16).padStart(2,'0')).join('');
  }
  function u8ToB64(u8){
    let s = '';
    for (let i=0;i<u8.length;i++) s += String.fromCharCode(u8[i]);
    return btoa(s);
  }
  function b64ToU8(b64){
    const bin = atob(b64.trim());
    const u8 = new Uint8Array(bin.length);
    for (let i=0;i<bin.length;i++) u8[i] = bin.charCodeAt(i);
    return u8;
  }

  async function sha256Bytes(str){
    const enc = new TextEncoder().encode(str);
    const hash = await crypto.subtle.digest('SHA-256', enc);
    return new Uint8Array(hash);
  }

  async function deriveKeyBytes(password, algo){
    const hash = await sha256Bytes(password);
    const keyLen = (algo==='aes256') ? 32 : (algo==='aes192') ? 24 : 16;
    return hash.slice(0, keyLen);
  }

  function setLoading(outEl, yes){
    outEl.classList.toggle('loading', !!yes);
  }

  async function copyText(text){
    if (!text) { toast('warn', '–ù–µ—á–µ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å'); return; }
    try{
      await navigator.clipboard.writeText(text);
      toast('ok', '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ');
      // –í Telegram —á–∞—Å—Ç–æ —É–¥–æ–±–Ω–æ: showPopup/closing not needed.
    }catch(e){
      toast('error', '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±—Ä–∞—É–∑–µ—Ä–∞)');
    }
  }

  function saveText(text, filename){
    if (!text) { toast('warn', '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è'); return; }
    const blob = new Blob([text], {type:'text/plain;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
    toast('ok', '–§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
  }

  // ========= Ripple =========
  function addRipple(e){
    const btn = e.currentTarget;
    const rect = btn.getBoundingClientRect();
    const x = (e.clientX ?? (rect.left + rect.width/2)) - rect.left;
    const y = (e.clientY ?? (rect.top + rect.height/2)) - rect.top;
    const span = document.createElement('span');
    span.className = 'ripple';
    span.style.left = x + 'px';
    span.style.top = y + 'px';
    span.style.width = '12px';
    span.style.height = '12px';
    btn.appendChild(span);
    setTimeout(() => span.remove(), 620);
  }
  document.querySelectorAll('button').forEach(b => b.addEventListener('pointerdown', addRipple, {passive:true}));

  // ========= Tabs =========
  const tabButtons = Array.from(document.querySelectorAll('.tab'));
  const sections = {
    enc: $('sec-enc'),
    dec: $('sec-dec'),
    key: $('sec-key'),
    log: $('sec-log'),
  };
  function setTab(name){
    tabButtons.forEach(b => b.classList.toggle('active', b.dataset.tab === name));
    Object.entries(sections).forEach(([k, el]) => el.classList.toggle('active', k === name));
    addLog('–ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï', 'OK', `–í–∫–ª–∞–¥–∫–∞: ${name}`);
    haptic('impact','light');
  }
  tabButtons.forEach(b => b.addEventListener('click', () => setTab(b.dataset.tab)));

  // ========= Show password toggles =========
  $('showEnc').addEventListener('change', (e) => $('encPass').type = e.target.checked ? 'text' : 'password');
  $('showDec').addEventListener('change', (e) => $('decPass').type = e.target.checked ? 'text' : 'password');

  // ========= Key generation =========
  const keyOut = $('keyOut');
  const keyMeta = $('keyMeta');

  function genPassword(len){
    const upper = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    const lower = 'abcdefghijklmnopqrstuvwxyz';
    const nums  = '0123456789';
    const spec  = '!@#$%^&*()_+-=[]{}|;:,.<>?';
    const chars = upper + lower + nums + spec;

    const rnd = new Uint32Array(len);
    crypto.getRandomValues(rnd);
    let out = '';
    for (let i=0;i<len;i++) out += chars[rnd[i] % chars.length];
    return out;
  }

  function genKey(){
    const type = $('keyType').value;
    const len = parseInt($('keyLen').value, 10);
    let v = '';

    if (type === 'password') v = genPassword(len);
    if (type === 'hex256') v = bytesToHex(crypto.getRandomValues(new Uint8Array(32)));
    if (type === 'b64256') v = u8ToB64(crypto.getRandomValues(new Uint8Array(32)));

    keyOut.textContent = v;
    keyMeta.textContent = `${v.length} —Å–∏–º–≤–æ–ª–æ–≤`;
    toast('ok','–ö–ª—é—á —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω');
    addLog('–ì–ï–ù–ï–†–ê–¶–ò–Ø –ö–õ–Æ–ß–ê', 'OK', type);
  }

  $('keyType').addEventListener('change', () => {
    const isPass = $('keyType').value === 'password';
    $('lenGroup').style.display = isPass ? '' : 'none';
  });

  $('btnGenKey').addEventListener('click', genKey);
  $('btnUseKey').addEventListener('click', () => {
    const v = keyOut.textContent.trim();
    if (!v) return toast('warn','–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á');
    $('encPass').value = v;
    setTab('enc');
    toast('ok','–ö–ª—é—á –≤—Å—Ç–∞–≤–ª–µ–Ω –≤ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ');
    addLog('–ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï –ö–õ–Æ–ß–ê', 'OK', '–í –ø–æ–ª–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è');
  });

  $('btnCopyKey').addEventListener('click', () => copyText(keyOut.textContent.trim()));
  $('btnSaveKey').addEventListener('click', () => saveText(keyOut.textContent.trim(), 'key.txt'));

  // ========= Encrypt/Decrypt =========
  const ctOut = $('ctOut');
  const ptOut = $('ptOut');
  const encMeta = $('encMeta');
  const decMeta = $('decMeta');

  $('btnGenPass').addEventListener('click', () => {
    $('encPass').value = genPassword(32);
    toast('ok','–ü–∞—Ä–æ–ª—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω');
    addLog('–ì–ï–ù–ï–†–ê–¶–ò–Ø –ü–ê–†–û–õ–Ø', 'OK', '32 —Å–∏–º–≤–æ–ª–∞');
    haptic('impact','medium');
  });

  $('btnCopyPass').addEventListener('click', () => copyText($('encPass').value));

  $('btnEncrypt').addEventListener('click', async () => {
    const pt = $('pt').value;
    const pass = $('encPass').value;
    const algo = $('encAlgo').value;

    if (!pt.trim()) return toast('warn','–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç');
    if (!pass) return toast('warn','–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å');
    if (pass.length < 8) return toast('warn','–ü–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π (–º–∏–Ω. 8)');

    setLoading(ctOut, true);
    runtimeInfo.textContent = '–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ...';

    try{
      const keyBytes = await deriveKeyBytes(pass, algo);
      const iv = crypto.getRandomValues(new Uint8Array(12));
      const key = await crypto.subtle.importKey('raw', keyBytes, 'AES-GCM', false, ['encrypt']);
      const data = new TextEncoder().encode(pt);

      const encrypted = await crypto.subtle.encrypt({name:'AES-GCM', iv}, key, data);
      const encU8 = new Uint8Array(encrypted);

      const combined = new Uint8Array(iv.length + encU8.length);
      combined.set(iv, 0);
      combined.set(encU8, iv.length);

      const b64 = u8ToB64(combined);
      ctOut.textContent = b64;
      encMeta.textContent = `${b64.length} —Å–∏–º–≤–æ–ª–æ–≤`;

      toast('ok','–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ');
      addLog('–®–ò–§–†–û–í–ê–ù–ò–ï', 'OK', algo);
      haptic('impact','heavy');
    }catch(e){
      toast('error','–û—à–∏–±–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è');
      addLog('–®–ò–§–†–û–í–ê–ù–ò–ï', 'ERR', e?.message || 'unknown');
    }finally{
      setLoading(ctOut,false);
      runtimeInfo.textContent = '–ì–æ—Ç–æ–≤–æ';
    }
  });

  $('btnDecrypt').addEventListener('click', async () => {
    const b64 = $('ct').value.trim();
    const pass = $('decPass').value;

    if (!b64) return toast('warn','–í—Å—Ç–∞–≤—å—Ç–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
    if (!pass) return toast('warn','–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å');

    setLoading(ptOut,true);
    runtimeInfo.textContent = '–î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ...';

    try{
      const combined = b64ToU8(b64);
      if (combined.length < 13) throw new Error('–°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–µ –¥–∞–Ω–Ω—ã–µ');
      const iv = combined.slice(0,12);
      const encData = combined.slice(12);

      const algos = ['aes256','aes192','aes128'];
      let ok = false;
      for (const algo of algos){
        try{
          const keyBytes = await deriveKeyBytes(pass, algo);
          const key = await crypto.subtle.importKey('raw', keyBytes, 'AES-GCM', false, ['decrypt']);
          const plainBuf = await crypto.subtle.decrypt({name:'AES-GCM', iv}, key, encData);
          const plain = new TextDecoder().decode(plainBuf);
          ptOut.textContent = plain;
          decMeta.textContent = `${plain.length} —Å–∏–º–≤–æ–ª–æ–≤`;
          ok = true;
          addLog('–î–ï–®–ò–§–†–û–í–ê–ù–ò–ï', 'OK', `algo=${algo}`);
          toast('ok','–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ');
          haptic('impact','heavy');
          break;
        }catch(_e){}
      }
      if (!ok) throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
    }catch(e){
      ptOut.textContent = '';
      decMeta.textContent = '0 —Å–∏–º–≤–æ–ª–æ–≤';
      toast('error','–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å');
      addLog('–î–ï–®–ò–§–†–û–í–ê–ù–ò–ï', 'ERR', e?.message || 'unknown');
    }finally{
      setLoading(ptOut,false);
      runtimeInfo.textContent = '–ì–æ—Ç–æ–≤–æ';
    }
  });

  $('btnCopyCT').addEventListener('click', () => copyText(ctOut.textContent.trim()));
  $('btnSaveCT').addEventListener('click', () => saveText(ctOut.textContent.trim(), 'encrypted.txt'));
  $('btnCopyPT').addEventListener('click', () => copyText(ptOut.textContent.trim()));
  $('btnSavePT').addEventListener('click', () => saveText(ptOut.textContent.trim(), 'decrypted.txt'));

  // ========= Log export/clear =========
  $('btnExportLog').addEventListener('click', () => {
    const text = log.slice().map(x => `[${x.t}] ${x.op} [${x.status}]${x.details ? ' ‚Äî ' + x.details : ''}`).join('\n');
    saveText(text || '–ñ—É—Ä–Ω–∞–ª –ø—É—Å—Ç.', 'log.txt');
  });
  $('btnClearLog').addEventListener('click', () => {
    log.length = 0;
    renderLog();
    toast('ok','–ñ—É—Ä–Ω–∞–ª –æ—á–∏—â–µ–Ω');
    addLog('–ñ–£–†–ù–ê–õ', 'OK', '–æ—á–∏—Å—Ç–∫–∞');
  });

  // ========= Init =========
  addLog('–ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø', 'OK', tg ? 'Telegram WebApp' : 'Browser');
  renderLog();
})();
</script>
</body>
</html>
